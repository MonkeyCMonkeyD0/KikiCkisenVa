---
title: "Projet - Analyse de Données"
output: html_notebook
---

# Projet KikiCkisenVa - Prédiction

```{r message=FALSE, warning=FALSE, include=FALSE}
fact.data <- function(data) {
  if (!is.null(data$Attrition))
    data$Attrition <- as.factor(data$Attrition)
  data$BusinessTravel <- as.factor(data$BusinessTravel)
  data$Department <- as.factor(data$Department)
  data$Education <- as.factor(data$Education)
  data$EducationField <- as.factor(data$EducationField)
  data$EnvironmentSatisfaction <- as.factor(data$EnvironmentSatisfaction)
  data$Gender <- as.factor(data$Gender)
  data$JobInvolvement <- as.factor(data$JobInvolvement)
  data$JobLevel <- as.factor(data$JobLevel)
  data$JobRole <- as.factor(data$JobRole)
  data$JobSatisfaction <- as.factor(data$JobSatisfaction)
  data$MaritalStatus <- as.factor(data$MaritalStatus)
  data$OverTime <- as.factor(data$OverTime)
  data$PerformanceRating <- as.factor(data$PerformanceRating)
  data$RelationshipSatisfaction <- as.factor(data$RelationshipSatisfaction)
  data$StockOptionLevel <- as.factor(data$StockOptionLevel)
  data$WorkLifeBalance <- as.factor(data$WorkLifeBalance)
  return(data)
}
```

\section{Recuperation des donnees}
```{r}
data_train <- read.csv2("spreadsheets/data_train.csv", sep = ",")
data_train <- na.omit(data_train)
data_train <- fact.data(data_train)
dim(data_train)
head(data_train)
```
```{r}
data_test <- read.csv2("spreadsheets/data_test.csv", sep = ",")
data_test <- na.omit(data_test)
data_test <- fact.data(data_test)
dim(data_test)
head(data_test)
```
\subsection{Recupération des variables numériques}
```{r warning=FALSE}
data_train_num <- data_train[, unlist(lapply(data_train, is.numeric))]
data_train_num[16] <- data_train["Attrition"]
dim(data_train_num)
head(data_train_num)
```
```{r}
data_test_num <- data_test[, unlist(lapply(data_test, is.numeric))]
dim(data_test_num)
head(data_test_num)
```

\subsection{Récupération des coordonnées}
```{r warning=FALSE}
data_train_log <- log(data_train_num[-16])
data_train_log[data_train_log == -Inf] <- 0
data_train_log <- t(scale(t(data_train_log)))
data_train_log <- as.data.frame(data_train_log)
data_train_log[16] <- data_train["Attrition"]
coord_data_train <- PCA(data_train_log, scale.unit = TRUE, graph = FALSE, quali.sup = 16)$ind$coord[,1:2]
plot(coord_data_train[,1], coord_data_train[,2], col = data_train$Attrition, xlab = "Axe 1", ylab = "Axe 2")
legend('topright', legend = levels(data_train$Attrition), col = 1:2, cex = 0.8, pch = 1)
```
```{r message=FALSE, warning=FALSE}
data_test_log <- log(data_test_num)
data_test_log[data_test_log == -Inf] <- 0
data_test_log <- t(scale(t(data_test_log)))
data_test_log <- as.data.frame(data_test_log)
coord_data_test <- PCA(data_test_log, scale.unit = TRUE, graph = FALSE)$ind$coord[,1:2]
plot(coord_data_test[,1], coord_data_test[,2], xlab = "Axe 1", ylab = "Axe 2")
```

\section{Classification}
```{r}
library(klaR)
partimat(coord_data_train, grouping = data_train_num$Attrition, method = "lda")
partimat(coord_data_train, grouping = data_train_num$Attrition, method = "qda")
```

\section{Prediction}
```{r message=FALSE, warning=FALSE}
res.qda = qda(data_train_num[-16], grouping = data_train_num$Attrition)
res.qda
pred.qda = predict(res.qda, data_train_num[-16])$class
table(data_train_num$Attrition, pred.qda)
```
Sur les Yes prédits on a plus d'erreurs que de cas juste alors que ce n'est pas le cas avec les prédiction sur No.

\section{Équilibrage de la répartition des données}
```{r}
library(DMwR)
table(data_train_num$Attrition)
data_train_bal <- SMOTE(Attrition ~ ., data_train_num)
table(data_train_bal$Attrition)
```

\section{Détermination du meilleur modèle}






